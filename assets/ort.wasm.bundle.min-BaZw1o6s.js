var Ha=Object.defineProperty;var za=(e,r,a)=>r in e?Ha(e,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[r]=a;var nn=(e,r,a)=>za(e,typeof r!="symbol"?r+"":r,a);/*!
 * ONNX Runtime Web v1.23.2
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var jt=Object.defineProperty,Qa=Object.getOwnPropertyDescriptor,Ya=Object.getOwnPropertyNames,Za=Object.prototype.hasOwnProperty,qa=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,a)=>(typeof require<"u"?require:r)[a]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),U=(e,r)=>()=>(e&&(r=e(e=0)),r),it=(e,r)=>{for(var a in r)jt(e,a,{get:r[a],enumerable:!0})},Xa=(e,r,a,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ya(r))!Za.call(e,i)&&i!==a&&jt(e,i,{get:()=>r[i],enumerable:!(s=Qa(r,i))||s.enumerable});return e},Dt=e=>Xa(jt({},"__esModule",{value:!0}),e),De,pe,nt,an,Tn,On=U(()=>{De=new Map,pe=[],nt=(e,r,a)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let s=De.get(e);if(s===void 0)De.set(e,{backend:r,priority:a});else{if(s.priority>a)return;if(s.priority===a&&s.backend!==r)throw new Error(`cannot register backend "${e}" using priority ${a}`)}if(a>=0){let i=pe.indexOf(e);i!==-1&&pe.splice(i,1);for(let o=0;o<pe.length;o++)if(De.get(pe[o]).priority<=a){pe.splice(o,0,e);return}pe.push(e)}return}throw new TypeError("not a valid backend")},an=async e=>{let r=De.get(e);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let a=!!r.initPromise;try{return a||(r.initPromise=r.backend.init(e)),await r.initPromise,r.initialized=!0,r.backend}catch(s){return a||(r.error=`${s}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},Tn=async e=>{let r=e.executionProviders||[],a=r.map(d=>typeof d=="string"?d:d.name),s=a.length===0?pe:a,i,o=[],u=new Set;for(let d of s){let f=await an(d);typeof f=="string"?o.push({name:d,err:f}):(i||(i=f),i===f&&u.add(d))}if(!i)throw new Error(`no available backend found. ERR: ${o.map(d=>`[${d.name}] ${d.err}`).join(", ")}`);for(let{name:d,err:f}of o)a.includes(d)&&console.warn(`removing requested execution provider "${d}" from session options because it is not available: ${f}`);let c=r.filter(d=>u.has(typeof d=="string"?d:d.name));return[i,new Proxy(e,{get:(d,f)=>f==="executionProviders"?c:Reflect.get(d,f)})]}}),Ja=U(()=>{On()}),An,Ka=U(()=>{An="1.23.2"}),Ot,Q,Cn=U(()=>{Ka(),Ot="warning",Q={wasm:{},webgl:{},webgpu:{},versions:{common:An},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);Ot=e}},get logLevel(){return Ot}},Object.defineProperty(Q,"logLevel",{enumerable:!0})}),F,eo=U(()=>{Cn(),F=Q}),_n,Rn,to=U(()=>{_n=(e,r)=>{let a=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);a.width=e.dims[3],a.height=e.dims[2];let s=a.getContext("2d");if(s!=null){let i,o;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[3]):(i=e.dims[3],o=e.dims[2]);let u=(r==null?void 0:r.format)!==void 0?r.format:"RGB",c=r==null?void 0:r.norm,d,f;c===void 0||c.mean===void 0?d=[255,255,255,255]:typeof c.mean=="number"?d=[c.mean,c.mean,c.mean,c.mean]:(d=[c.mean[0],c.mean[1],c.mean[2],0],c.mean[3]!==void 0&&(d[3]=c.mean[3])),c===void 0||c.bias===void 0?f=[0,0,0,0]:typeof c.bias=="number"?f=[c.bias,c.bias,c.bias,c.bias]:(f=[c.bias[0],c.bias[1],c.bias[2],0],c.bias[3]!==void 0&&(f[3]=c.bias[3]));let m=o*i,w=0,y=m,b=m*2,E=-1;u==="RGBA"?(w=0,y=m,b=m*2,E=m*3):u==="RGB"?(w=0,y=m,b=m*2):u==="RBG"&&(w=0,b=m,y=m*2);for(let x=0;x<o;x++)for(let M=0;M<i;M++){let v=(e.data[w++]-f[0])*d[0],O=(e.data[y++]-f[1])*d[1],S=(e.data[b++]-f[2])*d[2],I=E===-1?255:(e.data[E++]-f[3])*d[3];s.fillStyle="rgba("+v+","+O+","+S+","+I+")",s.fillRect(M,x,1,1)}if("toDataURL"in a)return a.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Rn=(e,r)=>{let a=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),s;if(a!=null){let i,o,u;(r==null?void 0:r.tensorLayout)!==void 0&&r.tensorLayout==="NHWC"?(i=e.dims[2],o=e.dims[1],u=e.dims[3]):(i=e.dims[3],o=e.dims[2],u=e.dims[1]);let c=r!==void 0&&r.format!==void 0?r.format:"RGB",d=r==null?void 0:r.norm,f,m;d===void 0||d.mean===void 0?f=[255,255,255,255]:typeof d.mean=="number"?f=[d.mean,d.mean,d.mean,d.mean]:(f=[d.mean[0],d.mean[1],d.mean[2],255],d.mean[3]!==void 0&&(f[3]=d.mean[3])),d===void 0||d.bias===void 0?m=[0,0,0,0]:typeof d.bias=="number"?m=[d.bias,d.bias,d.bias,d.bias]:(m=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(m[3]=d.bias[3]));let w=o*i;if(r!==void 0&&(r.format!==void 0&&u===4&&r.format!=="RGBA"||u===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let y=4,b=0,E=1,x=2,M=3,v=0,O=w,S=w*2,I=-1;c==="RGBA"?(v=0,O=w,S=w*2,I=w*3):c==="RGB"?(v=0,O=w,S=w*2):c==="RBG"&&(v=0,S=w,O=w*2),s=a.createImageData(i,o);for(let L=0;L<o*i;b+=y,E+=y,x+=y,M+=y,L++)s.data[b]=(e.data[v++]-m[0])*f[0],s.data[E]=(e.data[O++]-m[1])*f[1],s.data[x]=(e.data[S++]-m[2])*f[2],s.data[M]=I===-1?255:(e.data[I++]-m[3])*f[3]}else throw new Error("Can not access image data");return s}}),Xe,Un,xn,Sn,Mn,Ln,ro=U(()=>{Ht(),Xe=(e,r)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:a,width:s}=r,i=r.norm??{mean:255,bias:0},o,u;typeof i.mean=="number"?o=[i.mean,i.mean,i.mean,i.mean]:o=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?u=[i.bias,i.bias,i.bias,i.bias]:u=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let c=r.format!==void 0?r.format:"RGBA",d=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",f=a*s,m=d==="RGBA"?new Float32Array(f*4):new Float32Array(f*3),w=4,y=0,b=1,E=2,x=3,M=0,v=f,O=f*2,S=-1;c==="RGB"&&(w=3,y=0,b=1,E=2,x=-1),d==="RGBA"?S=f*3:d==="RBG"?(M=0,O=f,v=f*2):d==="BGR"&&(O=0,v=f,M=f*2);for(let I=0;I<f;I++,y+=w,E+=w,b+=w,x+=w)m[M++]=(e[y]+u[0])/o[0],m[v++]=(e[b]+u[1])/o[1],m[O++]=(e[E]+u[2])/o[2],S!==-1&&x!==-1&&(m[S++]=(e[x]+u[3])/o[3]);return d==="RGBA"?new ee("float32",m,[1,4,a,s]):new ee("float32",m,[1,3,a,s])},Un=async(e,r)=>{let a=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,o=typeof e=="string",u,c=r??{},d=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(a){let m=d();m.width=e.width,m.height=e.height;let w=f(m);if(w!=null){let y=e.height,b=e.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(y=r.resizedHeight,b=r.resizedWidth),r!==void 0){if(c=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");c.tensorFormat="RGBA",c.height=y,c.width=b}else c.tensorFormat="RGBA",c.height=y,c.width=b;w.drawImage(e,0,0),u=w.getImageData(0,0,b,y).data}else throw new Error("Can not access image data")}else if(s){let m,w;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(m=r.resizedHeight,w=r.resizedWidth):(m=e.height,w=e.width),r!==void 0&&(c=r),c.format="RGBA",c.height=m,c.width=w,r!==void 0){let y=d();y.width=w,y.height=m;let b=f(y);if(b!=null)b.putImageData(e,0,0),u=b.getImageData(0,0,w,m).data;else throw new Error("Can not access image data")}else u=e.data}else if(i){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let m=d();m.width=e.width,m.height=e.height;let w=f(m);if(w!=null){let y=e.height,b=e.width;return w.drawImage(e,0,0,b,y),u=w.getImageData(0,0,b,y).data,c.height=y,c.width=b,Xe(u,c)}else throw new Error("Can not access image data")}else{if(o)return new Promise((m,w)=>{let y=d(),b=f(y);if(!e||!b)return w();let E=new Image;E.crossOrigin="Anonymous",E.src=e,E.onload=()=>{y.width=E.width,y.height=E.height,b.drawImage(E,0,0,y.width,y.height);let x=b.getImageData(0,0,y.width,y.height);c.height=y.height,c.width=y.width,m(Xe(x.data,c))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(u!==void 0)return Xe(u,c);throw new Error("Input data provided is not supported - aborted tensor creation")},xn=(e,r)=>{let{width:a,height:s,download:i,dispose:o}=r,u=[1,s,a,4];return new ee({location:"texture",type:"float32",texture:e,dims:u,download:i,dispose:o})},Sn=(e,r)=>{let{dataType:a,dims:s,download:i,dispose:o}=r;return new ee({location:"gpu-buffer",type:a??"float32",gpuBuffer:e,dims:s,download:i,dispose:o})},Mn=(e,r)=>{let{dataType:a,dims:s,download:i,dispose:o}=r;return new ee({location:"ml-tensor",type:a??"float32",mlTensor:e,dims:s,download:i,dispose:o})},Ln=(e,r,a)=>new ee({location:"cpu-pinned",type:e,data:r,dims:a??[r.length]})}),ve,je,At,Pn,no=U(()=>{ve=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),je=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),At=!1,Pn=()=>{if(!At){At=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,a=globalThis.Float16Array,s=typeof a<"u"&&a.from;e&&(ve.set("int64",BigInt64Array),je.set(BigInt64Array,"int64")),r&&(ve.set("uint64",BigUint64Array),je.set(BigUint64Array,"uint64")),s?(ve.set("float16",a),je.set(a,"float16")):ve.set("float16",Uint16Array)}}}),In,kn,ao=U(()=>{Ht(),In=e=>{let r=1;for(let a=0;a<e.length;a++){let s=e[a];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${a}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${a}] must be a non-negative integer, got: ${s}`);r*=s}return r},kn=(e,r)=>{switch(e.location){case"cpu":return new ee(e.type,e.data,r);case"cpu-pinned":return new ee({location:"cpu-pinned",data:e.data,type:e.type,dims:r});case"texture":return new ee({location:"texture",texture:e.texture,type:e.type,dims:r});case"gpu-buffer":return new ee({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:r});case"ml-tensor":return new ee({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),ee,Ht=U(()=>{to(),ro(),no(),ao(),ee=class{constructor(e,r,a){Pn();let s,i;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,s=e.type,i=e.dims,e.location){case"cpu-pinned":{let u=ve.get(s);if(!u)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(e.data instanceof u))throw new TypeError(`buffer should be of type ${u.name}`);this.cpuData=e.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let u,c;if(typeof e=="string")if(s=e,c=a,e==="string"){if(!Array.isArray(r))throw new TypeError("A string tensor's data must be a string array.");u=r}else{let d=ve.get(e);if(d===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(r)){if(e==="float16"&&d===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${d.name} as data.`);e==="uint64"||e==="int64"?u=d.from(r,BigInt):u=d.from(r)}else if(r instanceof d)u=r;else if(r instanceof Uint8ClampedArray)if(e==="uint8")u=Uint8Array.from(r);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&r instanceof Uint16Array&&d!==Uint16Array)u=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw new TypeError(`A ${s} tensor's data must be type of ${d}`)}else if(c=r,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let d=typeof e[0];if(d==="string")s="string",u=e;else if(d==="boolean")s="bool",u=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${d}.`)}else if(e instanceof Uint8ClampedArray)s="uint8",u=Uint8Array.from(e);else{let d=je.get(e.constructor);if(d===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=d,u=e}if(c===void 0)c=[u.length];else if(!Array.isArray(c))throw new TypeError("A tensor's dims must be a number array");i=c,this.cpuData=u,this.dataLocation="cpu"}let o=In(i);if(this.cpuData&&o!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(o/2)===this.cpuData.length))throw new Error(`Tensor's size(${o}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=i,this.size=o}static async fromImage(e,r){return Un(e,r)}static fromTexture(e,r){return xn(e,r)}static fromGpuBuffer(e,r){return Sn(e,r)}static fromMLTensor(e,r){return Mn(e,r)}static fromPinnedBuffer(e,r,a){return Ln(e,r,a)}toDataURL(e){return _n(this,e)}toImageData(e){return Rn(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,e&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return kn(this,e)}}}),ue,Bn=U(()=>{Ht(),ue=ee}),Ft,Ct,Re,Ue,xe,Se,$n=U(()=>{Cn(),Ft=(e,r)=>{(typeof Q.trace>"u"?!Q.wasm.trace:!Q.trace)||console.timeStamp(`${e}::ORT::${r}`)},Ct=(e,r)=>{var i;let a=((i=new Error().stack)==null?void 0:i.split(/\r\n|\r|\n/g))||[],s=!1;for(let o=0;o<a.length;o++){if(s&&!a[o].includes("TRACE_FUNC")){let u=`FUNC_${e}::${a[o].trim().split(" ")[1]}`;r&&(u+=`::${r}`),Ft("CPU",u);return}a[o].includes("TRACE_FUNC")&&(s=!0)}},Re=e=>{(typeof Q.trace>"u"?!Q.wasm.trace:!Q.trace)||Ct("BEGIN",e)},Ue=e=>{(typeof Q.trace>"u"?!Q.wasm.trace:!Q.trace)||Ct("END",e)},xe=e=>{(typeof Q.trace>"u"?!Q.wasm.trace:!Q.trace)||console.time(`ORT::${e}`)},Se=e=>{(typeof Q.trace>"u"?!Q.wasm.trace:!Q.trace)||console.timeEnd(`ORT::${e}`)}}),Nn,oo=U(()=>{On(),Bn(),$n(),Nn=class Dn{constructor(r){this.handler=r}async run(r,a,s){Re(),xe("InferenceSession.run");let i={},o={};if(typeof r!="object"||r===null||r instanceof ue||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let u=!0;if(typeof a=="object"){if(a===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(a instanceof ue)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(a)){if(a.length===0)throw new TypeError("'fetches' cannot be an empty array.");u=!1;for(let f of a){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);i[f]=null}if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let f=!1,m=Object.getOwnPropertyNames(a);for(let w of this.outputNames)if(m.indexOf(w)!==-1){let y=a[w];(y===null||y instanceof ue)&&(f=!0,u=!1,i[w]=y)}if(f){if(typeof s=="object"&&s!==null)o=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else o=a}}else if(typeof a<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let f of this.inputNames)if(typeof r[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(u)for(let f of this.outputNames)i[f]=null;let c=await this.handler.run(r,i,o),d={};for(let f in c)if(Object.hasOwnProperty.call(c,f)){let m=c[f];m instanceof ue?d[f]=m:d[f]=new ue(m.type,m.data,m.dims)}return Se("InferenceSession.run"),Ue(),d}async release(){return this.handler.dispose()}static async create(r,a,s,i){Re(),xe("InferenceSession.create");let o,u={};if(typeof r=="string"){if(o=r,typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(o=r,typeof a=="object"&&a!==null)u=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let m=r,w=0,y=r.byteLength;if(typeof a=="object"&&a!==null)u=a;else if(typeof a=="number"){if(w=a,!Number.isSafeInteger(w))throw new RangeError("'byteOffset' must be an integer.");if(w<0||w>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(y=r.byteLength-w,typeof s=="number"){if(y=s,!Number.isSafeInteger(y))throw new RangeError("'byteLength' must be an integer.");if(y<=0||w+y>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-w}].`);if(typeof i=="object"&&i!==null)u=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof a<"u")throw new TypeError("'options' must be an object.");o=new Uint8Array(m,w,y)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[c,d]=await Tn(u),f=await c.createInferenceSessionHandler(o,d);return Se("InferenceSession.create"),Ue(),new Dn(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Fn,io=U(()=>{oo(),Fn=Nn}),so=U(()=>{}),uo=U(()=>{}),lo=U(()=>{}),fo=U(()=>{}),Wn={};it(Wn,{InferenceSession:()=>Fn,TRACE:()=>Ft,TRACE_EVENT_BEGIN:()=>xe,TRACE_EVENT_END:()=>Se,TRACE_FUNC_BEGIN:()=>Re,TRACE_FUNC_END:()=>Ue,Tensor:()=>ue,env:()=>F,registerBackend:()=>nt});var Ee=U(()=>{Ja(),eo(),io(),Bn(),so(),uo(),$n(),lo(),fo()}),zt=U(()=>{}),Gn={};it(Gn,{default:()=>Vn});var _t,Rt,Vn,co=U(()=>{var e;ra(),Me(),Qt(),_t="ort-wasm-proxy-worker",Rt=((e=globalThis.self)==null?void 0:e.name)===_t,Rt&&(self.onmessage=r=>{let{type:a,in:s}=r.data;try{switch(a){case"init-wasm":Yt(s.wasm).then(()=>{Kt(s).then(()=>{postMessage({type:a})},i=>{postMessage({type:a,err:i})})},i=>{postMessage({type:a,err:i})});break;case"init-ep":{let{epName:i,env:o}=s;er(o,i).then(()=>{postMessage({type:a})},u=>{postMessage({type:a,err:u})});break}case"copy-from":{let{buffer:i}=s,o=ot(i);postMessage({type:a,out:o});break}case"create":{let{model:i,options:o}=s;tr(i,o).then(u=>{postMessage({type:a,out:u})},u=>{postMessage({type:a,err:u})});break}case"release":rr(s),postMessage({type:a});break;case"run":{let{sessionId:i,inputIndices:o,inputs:u,outputIndices:c,options:d}=s;nr(i,o,u,c,new Array(c.length).fill(null),d).then(f=>{f.some(m=>m[3]!=="cpu")?postMessage({type:a,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:a,out:f},or([...u,...f]))},f=>{postMessage({type:a,err:f})});break}case"end-profiling":ar(s),postMessage({type:a});break;default:}}catch(i){postMessage({type:a,err:i})}}),Vn=Rt?null:r=>new Worker(r??K,{type:"module",name:_t})}),jn={};it(jn,{default:()=>Hn});var Ut,Hn,on,po=U(()=>{var e,r;Ut=async function(a={}){var rn;var s,i,o=a,u=new Promise((t,n)=>{s=t,i=n}),c=typeof window=="object",d=typeof WorkerGlobalScope<"u",f=d&&((rn=self.name)==null?void 0:rn.startsWith("em-pthread"));o.mountExternalData=(t,n)=>{t.startsWith("./")&&(t=t.substring(2)),(o.Sa||(o.Sa=new Map)).set(t,n)},o.unmountExternalData=()=>{delete o.Sa};var m,w,y=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,kb:!0}).buffer.constructor,b=(t,n)=>{throw n},E=import.meta.url,x="";if(c||d){try{x=new URL(".",E).href}catch{}d&&(w=t=>{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),m=async t=>{if(He(t))return new Promise((l,p)=>{var h=new XMLHttpRequest;h.open("GET",t,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?l(h.response):p(h.status)},h.onerror=p,h.send(null)});var n=await fetch(t,{credentials:"same-origin"});if(n.ok)return n.arrayBuffer();throw Error(n.status+" : "+n.url)}}var M,v,O,S,I,L,R,V,H,Z,q,Le,Pe,te=console.log.bind(console),ne=console.error.bind(console),Ie=te,A=ne,J=!1,He=t=>t.startsWith("file://");function ae(){return v.buffer!=I.buffer&&G(),I}function oe(){return v.buffer!=I.buffer&&G(),L}function W(){return v.buffer!=I.buffer&&G(),R}function T(){return v.buffer!=I.buffer&&G(),V}function j(){return v.buffer!=I.buffer&&G(),H}function me(){return v.buffer!=I.buffer&&G(),Z}function fe(){return v.buffer!=I.buffer&&G(),Le}if(f){let t=function(n){try{var l=n.data,p=l.Ra;if(p==="load"){let h=[];self.onmessage=g=>h.push(g),self.startWorker=()=>{postMessage({Ra:"loaded"});for(let g of h)t(g);self.onmessage=t};for(let g of l.Za)o[g]&&!o[g].proxy||(o[g]=(...C)=>{postMessage({Ra:"callHandler",Ya:g,args:C})},g=="print"&&(Ie=o[g]),g=="printErr"&&(A=o[g]));v=l.fb,G(),Pe(l.gb)}else if(p==="run"){ha(l.Qa),gt(l.Qa,0,0,1,0,0),cr(),dt(l.Qa),ze||(ze=!0);try{ma(l.bb,l.Va)}catch(h){if(h!="unwind")throw h}}else l.target!=="setimmediate"&&(p==="checkMailbox"?ze&&Ye():p&&(A(`worker: received unknown command ${p}`),A(l)))}catch(h){throw qr(),h}};var ze=!1;self.onunhandledrejection=n=>{throw n.reason||n},self.onmessage=t}function G(){var t=v.buffer;o.HEAP8=I=new Int8Array(t),R=new Int16Array(t),o.HEAPU8=L=new Uint8Array(t),o.HEAP32=V=new Int32Array(t),o.HEAPU32=H=new Uint32Array(t),Z=new Float32Array(t),Le=new Float64Array(t),q=new BigInt64Array(t),new BigUint64Array(t)}function ie(){f?startWorker(o):_.$()}var le,N=0,P=null;function re(){if(--N==0&&P){var t=P;P=null,t()}}function ce(t){throw A(t="Aborted("+t+")"),J=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),i(t),t}function Qe(){return{a:{j:ja,b:ya,E:yr,f:vr,U:Er,A:Tr,C:Or,V:Ar,S:Cr,L:_r,R:Rr,n:Ur,B:xr,y:Sr,T:Mr,z:Lr,_:ga,O:ba,w:va,F:Ea,t:Ta,i:Oa,N:dt,X:Aa,I:Ca,J:_a,K:Ra,G:$r,H:Nr,u:Dr,q:xa,Z:Ma,o:La,k:Pa,Y:Sa,d:Ia,W:ka,x:Ba,c:Ua,e:$a,h:Na,v:Da,s:Fa,r:Wa,P:Gr,Q:jr,D:ft,g:Hr,m:zr,M:Qr,l:Yr,a:v,p:lt}}}class st{constructor(n){nn(this,"name","ExitStatus");this.message=`Program terminated with exit(${n})`,this.status=n}}var ir=t=>{t.terminate(),t.onmessage=()=>{}},ut=[],sr=t=>{de.length==0&&(pr(),dr(de[0]));var n=de.pop();if(!n)return 6;ke.push(n),we[t.Qa]=n,n.Qa=t.Qa;var l={Ra:"run",bb:t.ab,Va:t.Va,Qa:t.Qa};return n.postMessage(l,t.Xa),0},Te=0,B=(t,n,...l)=>{for(var p=2*l.length,h=Et(),g=vt(8*p),C=g>>>3,D=0;D<l.length;D++){var z=l[D];typeof z=="bigint"?(q[C+2*D]=1n,q[C+2*D+1]=z):(q[C+2*D]=0n,fe()[C+2*D+1>>>0]=z)}return t=Xr(t,0,p,g,n),qe(h),t};function lt(t){if(f)return B(0,1,t);if(S=t,!(0<Te)){for(var n of ke)ir(n);for(n of de)ir(n);de=[],ke=[],we={},J=!0}b(0,new st(t))}function ur(t){if(f)return B(1,0,t);ft(t)}var ft=t=>{if(S=t,f)throw ur(t),"unwind";lt(t)},de=[],ke=[],lr=[],we={},fr=t=>{var n=t.Qa;delete we[n],de.push(t),ke.splice(ke.indexOf(t),1),t.Qa=0,Jr(n)};function cr(){lr.forEach(t=>t())}var dr=t=>new Promise(n=>{t.onmessage=h=>{var g=(h=h.data).Ra;if(h.Ta&&h.Ta!=yt()){var C=we[h.Ta];C?C.postMessage(h,h.Xa):A(`Internal error! Worker sent a message "${g}" to target pthread ${h.Ta}, but that thread no longer exists!`)}else g==="checkMailbox"?Ye():g==="spawnThread"?sr(h):g==="cleanupThread"?fr(we[h.cb]):g==="loaded"?(t.loaded=!0,n(t)):h.target==="setimmediate"?t.postMessage(h):g==="callHandler"?o[h.Ya](...h.args):g&&A(`worker sent an unknown command ${g}`)},t.onerror=h=>{throw A(`worker sent an error! ${h.filename}:${h.lineno}: ${h.message}`),h};var l,p=[];for(l of[])o.propertyIsEnumerable(l)&&p.push(l);t.postMessage({Ra:"load",Za:p,fb:v,gb:O})});function pr(){var t=new Worker((()=>{let n=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new n("ort.wasm.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});de.push(t)}var hr,ha=t=>{G();var n=j()[t+52>>>2>>>0];t=j()[t+56>>>2>>>0],tn(n,n-t),qe(n)},mr=[],ma=(t,n)=>{Te=0;var l=mr[t];l||(mr[t]=l=hr.get(t)),t=l(n),0<Te?S=t:bt(t)};class wa{constructor(n){this.Ua=n-24}}function ya(t,n,l){var p=new wa(t>>>=0);throw n>>>=0,l>>>=0,j()[p.Ua+16>>>2>>>0]=0,j()[p.Ua+4>>>2>>>0]=n,j()[p.Ua+8>>>2>>>0]=l,t}function wr(t,n,l,p){return f?B(2,1,t,n,l,p):yr(t,n,l,p)}function yr(t,n,l,p){if(t>>>=0,l>>>=0,p>>>=0,y===void 0)return 6;var h=[];return f&&h.length===0?wr(t,n>>>=0,l,p):(t={ab:l,Qa:t,Va:p,Xa:h},f?(t.Ra="spawnThread",postMessage(t,h),0):sr(t))}var gr=typeof TextDecoder<"u"?new TextDecoder:void 0,br=(t,n=0,l=NaN)=>{var p=(n>>>=0)+l;for(l=n;t[l]&&!(l>=p);)++l;if(16<l-n&&t.buffer&&gr)return gr.decode(t.buffer instanceof ArrayBuffer?t.subarray(n,l):t.slice(n,l));for(p="";n<l;){var h=t[n++];if(128&h){var g=63&t[n++];if((224&h)==192)p+=String.fromCharCode((31&h)<<6|g);else{var C=63&t[n++];65536>(h=(240&h)==224?(15&h)<<12|g<<6|C:(7&h)<<18|g<<12|C<<6|63&t[n++])?p+=String.fromCharCode(h):(h-=65536,p+=String.fromCharCode(55296|h>>10,56320|1023&h))}}else p+=String.fromCharCode(h)}return p},ct=(t,n)=>(t>>>=0)?br(oe(),t,n):"";function vr(t,n,l){return f?B(3,1,t,n,l):0}function Er(t,n){if(f)return B(4,1,t,n)}function Tr(t,n){if(f)return B(5,1,t,n)}function Or(t,n,l){if(f)return B(6,1,t,n,l)}function Ar(t,n,l){return f?B(7,1,t,n,l):0}function Cr(t,n){if(f)return B(8,1,t,n)}function _r(t,n,l){if(f)return B(9,1,t,n,l)}function Rr(t,n,l,p){if(f)return B(10,1,t,n,l,p)}function Ur(t,n,l,p){if(f)return B(11,1,t,n,l,p)}function xr(t,n,l,p){if(f)return B(12,1,t,n,l,p)}function Sr(t){if(f)return B(13,1,t)}function Mr(t,n){if(f)return B(14,1,t,n)}function Lr(t,n,l){if(f)return B(15,1,t,n,l)}var ga=()=>ce("");function ba(t){gt(t>>>0,!d,1,!c,131072,!1),cr()}var Pr=t=>{if(!J)try{if(t(),!(0<Te))try{f?bt(S):ft(S)}catch(n){n instanceof st||n=="unwind"||b(0,n)}}catch(n){n instanceof st||n=="unwind"||b(0,n)}};function dt(t){t>>>=0,typeof Atomics.eb=="function"&&(Atomics.eb(T(),t>>>2,t).value.then(Ye),t+=128,Atomics.store(T(),t>>>2,1))}var Ye=()=>{var t=yt();t&&(dt(t),Pr(en))};function va(t,n){(t>>>=0)==n>>>0?setTimeout(Ye):f?postMessage({Ta:t,Ra:"checkMailbox"}):(t=we[t])&&t.postMessage({Ra:"checkMailbox"})}var pt=[];function Ea(t,n,l,p,h){for(n>>>=0,p/=2,pt.length=p,l=h>>>0>>>3,h=0;h<p;h++)pt[h]=q[l+2*h]?q[l+2*h+1]:fe()[l+2*h+1>>>0];return(n?Zr[n]:Va[t])(...pt)}var Ta=()=>{Te=0};function Oa(t){t>>>=0,f?postMessage({Ra:"cleanupThread",cb:t}):fr(we[t])}function Aa(t){}function Ca(t,n){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),n>>>=0,t=new Date(1e3*t),T()[n>>>2>>>0]=t.getUTCSeconds(),T()[n+4>>>2>>>0]=t.getUTCMinutes(),T()[n+8>>>2>>>0]=t.getUTCHours(),T()[n+12>>>2>>>0]=t.getUTCDate(),T()[n+16>>>2>>>0]=t.getUTCMonth(),T()[n+20>>>2>>>0]=t.getUTCFullYear()-1900,T()[n+24>>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,T()[n+28>>>2>>>0]=t}var Ir=t=>t%4==0&&(t%100!=0||t%400==0),kr=[0,31,60,91,121,152,182,213,244,274,305,335],Br=[0,31,59,90,120,151,181,212,243,273,304,334];function _a(t,n){t=-9007199254740992>t||9007199254740992<t?NaN:Number(t),n>>>=0,t=new Date(1e3*t),T()[n>>>2>>>0]=t.getSeconds(),T()[n+4>>>2>>>0]=t.getMinutes(),T()[n+8>>>2>>>0]=t.getHours(),T()[n+12>>>2>>>0]=t.getDate(),T()[n+16>>>2>>>0]=t.getMonth(),T()[n+20>>>2>>>0]=t.getFullYear()-1900,T()[n+24>>>2>>>0]=t.getDay();var l=(Ir(t.getFullYear())?kr:Br)[t.getMonth()]+t.getDate()-1|0;T()[n+28>>>2>>>0]=l,T()[n+36>>>2>>>0]=-60*t.getTimezoneOffset(),l=new Date(t.getFullYear(),6,1).getTimezoneOffset();var p=new Date(t.getFullYear(),0,1).getTimezoneOffset();t=0|(l!=p&&t.getTimezoneOffset()==Math.min(p,l)),T()[n+32>>>2>>>0]=t}function Ra(t){t>>>=0;var n=new Date(T()[t+20>>>2>>>0]+1900,T()[t+16>>>2>>>0],T()[t+12>>>2>>>0],T()[t+8>>>2>>>0],T()[t+4>>>2>>>0],T()[t>>>2>>>0],0),l=T()[t+32>>>2>>>0],p=n.getTimezoneOffset(),h=new Date(n.getFullYear(),6,1).getTimezoneOffset(),g=new Date(n.getFullYear(),0,1).getTimezoneOffset(),C=Math.min(g,h);return 0>l?T()[t+32>>>2>>>0]=+(h!=g&&C==p):0<l!=(C==p)&&(h=Math.max(g,h),n.setTime(n.getTime()+6e4*((0<l?C:h)-p))),T()[t+24>>>2>>>0]=n.getDay(),l=(Ir(n.getFullYear())?kr:Br)[n.getMonth()]+n.getDate()-1|0,T()[t+28>>>2>>>0]=l,T()[t>>>2>>>0]=n.getSeconds(),T()[t+4>>>2>>>0]=n.getMinutes(),T()[t+8>>>2>>>0]=n.getHours(),T()[t+12>>>2>>>0]=n.getDate(),T()[t+16>>>2>>>0]=n.getMonth(),T()[t+20>>>2>>>0]=n.getYear(),t=n.getTime(),BigInt(isNaN(t)?-1:t/1e3)}function $r(t,n,l,p,h,g,C){return f?B(16,1,t,n,l,p,h,g,C):-52}function Nr(t,n,l,p,h,g){if(f)return B(17,1,t,n,l,p,h,g)}var Be={},Ua=()=>performance.timeOrigin+performance.now();function Dr(t,n){if(f)return B(18,1,t,n);if(Be[t]&&(clearTimeout(Be[t].id),delete Be[t]),!n)return 0;var l=setTimeout(()=>{delete Be[t],Pr(()=>Kr(t,performance.timeOrigin+performance.now()))},n);return Be[t]={id:l,lb:n},0}var Oe=(t,n,l)=>{var p=oe();if(n>>>=0,0<l){var h=n;l=n+l-1;for(var g=0;g<t.length;++g){var C=t.charCodeAt(g);if(55296<=C&&57343>=C&&(C=65536+((1023&C)<<10)|1023&t.charCodeAt(++g)),127>=C){if(n>=l)break;p[n++>>>0]=C}else{if(2047>=C){if(n+1>=l)break;p[n++>>>0]=192|C>>6}else{if(65535>=C){if(n+2>=l)break;p[n++>>>0]=224|C>>12}else{if(n+3>=l)break;p[n++>>>0]=240|C>>18,p[n++>>>0]=128|C>>12&63}p[n++>>>0]=128|C>>6&63}p[n++>>>0]=128|63&C}}p[n>>>0]=0,t=n-h}else t=0;return t};function xa(t,n,l,p){t>>>=0,n>>>=0,l>>>=0,p>>>=0;var h=new Date().getFullYear(),g=new Date(h,0,1).getTimezoneOffset();h=new Date(h,6,1).getTimezoneOffset();var C=Math.max(g,h);j()[t>>>2>>>0]=60*C,T()[n>>>2>>>0]=+(g!=h),t=(n=D=>{var z=Math.abs(D);return`UTC${0<=D?"-":"+"}${String(Math.floor(z/60)).padStart(2,"0")}${String(z%60).padStart(2,"0")}`})(g),n=n(h),h<g?(Oe(t,l,17),Oe(n,p,17)):(Oe(t,p,17),Oe(n,l,17))}var Sa=()=>Date.now();function Ma(t,n,l){return 0<=t&&3>=t?(t===0?t=Date.now():t=performance.timeOrigin+performance.now(),q[l>>>0>>>3]=BigInt(Math.round(1e6*t)),0):28}var ht=[];function La(t,n,l){t>>>=0,n>>>=0,l>>>=0,ht.length=0;for(var p;p=oe()[n++>>>0];){var h=p!=105;l+=(h&=p!=112)&&l%8?4:0,ht.push(p==112?j()[l>>>2>>>0]:p==106?q[l>>>3]:p==105?T()[l>>>2>>>0]:fe()[l>>>3>>>0]),l+=h?8:4}return Zr[t](...ht)}var Pa=()=>{};function Ia(t,n){return A(ct(t>>>0,n>>>0))}var ka=()=>{throw Te+=1,"unwind"};function Ba(){return 4294901760}var $a=()=>navigator.hardwareConcurrency;function Na(){return ce("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Da(t){t>>>=0;var n=oe().length;if(t<=n||4294901760<t)return!1;for(var l=1;4>=l;l*=2){var p=n*(1+.2/l);p=Math.min(p,t+100663296);e:{p=(Math.min(4294901760,65536*Math.ceil(Math.max(t,p)/65536))-v.buffer.byteLength+65535)/65536|0;try{v.grow(p),G();var h=1;break e}catch{}h=void 0}if(h)return!0}return!1}var Ze=()=>(ce("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),$e={},Fr=t=>{t.forEach(n=>{Ze()})};function Fa(){var t=Error().stack.toString().split(`
`);return t[0]=="Error"&&t.shift(),Fr(t),$e.Wa=Ze(),$e.$a=t,$e.Wa}function Wa(t,n,l){if(t>>>=0,n>>>=0,$e.Wa==t)var p=$e.$a;else(p=Error().stack.toString().split(`
`))[0]=="Error"&&p.shift(),Fr(p);for(var h=3;p[h]&&Ze()!=t;)++h;for(t=0;t<l&&p[t+h];++t)T()[n+4*t>>>2>>>0]=Ze();return t}var mt,wt={},Wr=()=>{if(!mt){var t,n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(t in wt)wt[t]===void 0?delete n[t]:n[t]=wt[t];var l=[];for(t in n)l.push(`${t}=${n[t]}`);mt=l}return mt};function Gr(t,n){if(f)return B(19,1,t,n);t>>>=0,n>>>=0;var l,p=0,h=0;for(l of Wr()){var g=n+p;j()[t+h>>>2>>>0]=g,p+=Oe(l,g,1/0)+1,h+=4}return 0}var Vr=t=>{for(var n=0,l=0;l<t.length;++l){var p=t.charCodeAt(l);127>=p?n++:2047>=p?n+=2:55296<=p&&57343>=p?(n+=4,++l):n+=3}return n};function jr(t,n){if(f)return B(20,1,t,n);t>>>=0,n>>>=0;var l=Wr();for(var p of(j()[t>>>2>>>0]=l.length,t=0,l))t+=Vr(p)+1;return j()[n>>>2>>>0]=t,0}function Hr(t){return f?B(21,1,t):52}function zr(t,n,l,p){return f?B(22,1,t,n,l,p):52}function Qr(t,n,l,p){return f?B(23,1,t,n,l,p):70}var Ga=[null,[],[]];function Yr(t,n,l,p){if(f)return B(24,1,t,n,l,p);n>>>=0,l>>>=0,p>>>=0;for(var h=0,g=0;g<l;g++){var C=j()[n>>>2>>>0],D=j()[n+4>>>2>>>0];n+=8;for(var z=0;z<D;z++){var Y=t,Ne=oe()[C+z>>>0],Tt=Ga[Y];Ne===0||Ne===10?((Y===1?Ie:A)(br(Tt)),Tt.length=0):Tt.push(Ne)}h+=D}return j()[p>>>2>>>0]=h,0}f||(function(){for(var t=o.numThreads-1;t--;)pr();ut.push(()=>{N++,(function(n){f?n():Promise.all(de.map(dr)).then(n)})(()=>re())})})(),f||(v=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),G()),o.wasmBinary&&(M=o.wasmBinary),o.stackSave=()=>Et(),o.stackRestore=t=>qe(t),o.stackAlloc=t=>vt(t),o.setValue=function(t,n,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":case"i8":ae()[t>>>0]=n;break;case"i16":W()[t>>>1>>>0]=n;break;case"i32":T()[t>>>2>>>0]=n;break;case"i64":q[t>>>3]=BigInt(n);break;case"float":me()[t>>>2>>>0]=n;break;case"double":fe()[t>>>3>>>0]=n;break;case"*":j()[t>>>2>>>0]=n;break;default:ce(`invalid type for setValue: ${l}`)}},o.getValue=function(t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":return ae()[t>>>0];case"i16":return W()[t>>>1>>>0];case"i32":return T()[t>>>2>>>0];case"i64":return q[t>>>3];case"float":return me()[t>>>2>>>0];case"double":return fe()[t>>>3>>>0];case"*":return j()[t>>>2>>>0];default:ce(`invalid type for getValue: ${n}`)}},o.UTF8ToString=ct,o.stringToUTF8=Oe,o.lengthBytesUTF8=Vr;var Va=[lt,ur,wr,vr,Er,Tr,Or,Ar,Cr,_r,Rr,Ur,xr,Sr,Mr,Lr,$r,Nr,Dr,Gr,jr,Hr,zr,Qr,Yr],Zr={853836:(t,n,l,p,h)=>{if(o===void 0||!o.Sa)return 1;if((t=ct(Number(t>>>0))).startsWith("./")&&(t=t.substring(2)),!(t=o.Sa.get(t)))return 2;if(n=Number(n>>>0),l=Number(l>>>0),p=Number(p>>>0),n+l>t.byteLength)return 3;try{let g=t.subarray(n,n+l);switch(h){case 0:oe().set(g,p>>>0);break;case 1:o.hb?o.hb(p,g):o.jb(p,g);break;default:return 4}return 0}catch{return 4}},854660:()=>typeof wasmOffsetConverter<"u"};function ja(){return typeof wasmOffsetConverter<"u"}var _=await(async function(){function t(p,h){return _=p.exports,_=(function(){var g=_,C=z=>()=>z()>>>0,D=z=>Y=>z(Y)>>>0;return(g=Object.assign({},g)).Aa=C(g.Aa),g.Ca=D(g.Ca),g.Oa=D(g.Oa),g.Pa=C(g.Pa),g.__cxa_get_exception_ptr=D(g.__cxa_get_exception_ptr),g})(),lr.push(_.Da),hr=_.Ea,O=h,re(),_}N++;var n=Qe();if(o.instantiateWasm)return new Promise(p=>{o.instantiateWasm(n,(h,g)=>{p(t(h,g))})});if(f)return new Promise(p=>{Pe=h=>{var g=new WebAssembly.Instance(h,Qe());p(t(g,h))}});le??(le=o.locateFile?o.locateFile?o.locateFile("ort-wasm-simd-threaded.wasm",x):x+"ort-wasm-simd-threaded.wasm":new URL("/komasync/assets/ort-wasm-simd-threaded-CxTQ5xH-.wasm",import.meta.url).href);try{var l=await(async function(p){var h=le;if(!M&&typeof WebAssembly.instantiateStreaming=="function"&&!He(h))try{var g=fetch(h,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(g,p)}catch(C){A(`wasm streaming compile failed: ${C}`),A("falling back to ArrayBuffer instantiation")}return(async function(C,D){try{var z=await(async function(Y){if(!M)try{var Ne=await m(Y);return new Uint8Array(Ne)}catch{}if(Y==le&&M)Y=new Uint8Array(M);else{if(!w)throw"both async and sync fetching of the wasm failed";Y=w(Y)}return Y})(C);return await WebAssembly.instantiate(z,D)}catch(Y){A(`failed to asynchronously prepare wasm: ${Y}`),ce(Y)}})(h,p)})(n);return t(l.instance,l.module)}catch(p){return i(p),Promise.reject(p)}})();o._OrtInit=(t,n)=>(o._OrtInit=_.aa)(t,n),o._OrtGetLastError=(t,n)=>(o._OrtGetLastError=_.ba)(t,n),o._OrtCreateSessionOptions=(t,n,l,p,h,g,C,D,z,Y)=>(o._OrtCreateSessionOptions=_.ca)(t,n,l,p,h,g,C,D,z,Y),o._OrtAppendExecutionProvider=(t,n,l,p,h)=>(o._OrtAppendExecutionProvider=_.da)(t,n,l,p,h),o._OrtAddFreeDimensionOverride=(t,n,l)=>(o._OrtAddFreeDimensionOverride=_.ea)(t,n,l),o._OrtAddSessionConfigEntry=(t,n,l)=>(o._OrtAddSessionConfigEntry=_.fa)(t,n,l),o._OrtReleaseSessionOptions=t=>(o._OrtReleaseSessionOptions=_.ga)(t),o._OrtCreateSession=(t,n,l)=>(o._OrtCreateSession=_.ha)(t,n,l),o._OrtReleaseSession=t=>(o._OrtReleaseSession=_.ia)(t),o._OrtGetInputOutputCount=(t,n,l)=>(o._OrtGetInputOutputCount=_.ja)(t,n,l),o._OrtGetInputOutputMetadata=(t,n,l,p)=>(o._OrtGetInputOutputMetadata=_.ka)(t,n,l,p),o._OrtFree=t=>(o._OrtFree=_.la)(t),o._OrtCreateTensor=(t,n,l,p,h,g)=>(o._OrtCreateTensor=_.ma)(t,n,l,p,h,g),o._OrtGetTensorData=(t,n,l,p,h)=>(o._OrtGetTensorData=_.na)(t,n,l,p,h),o._OrtReleaseTensor=t=>(o._OrtReleaseTensor=_.oa)(t),o._OrtCreateRunOptions=(t,n,l,p)=>(o._OrtCreateRunOptions=_.pa)(t,n,l,p),o._OrtAddRunConfigEntry=(t,n,l)=>(o._OrtAddRunConfigEntry=_.qa)(t,n,l),o._OrtReleaseRunOptions=t=>(o._OrtReleaseRunOptions=_.ra)(t),o._OrtCreateBinding=t=>(o._OrtCreateBinding=_.sa)(t),o._OrtBindInput=(t,n,l)=>(o._OrtBindInput=_.ta)(t,n,l),o._OrtBindOutput=(t,n,l,p)=>(o._OrtBindOutput=_.ua)(t,n,l,p),o._OrtClearBoundOutputs=t=>(o._OrtClearBoundOutputs=_.va)(t),o._OrtReleaseBinding=t=>(o._OrtReleaseBinding=_.wa)(t),o._OrtRunWithBinding=(t,n,l,p,h)=>(o._OrtRunWithBinding=_.xa)(t,n,l,p,h),o._OrtRun=(t,n,l,p,h,g,C,D)=>(o._OrtRun=_.ya)(t,n,l,p,h,g,C,D),o._OrtEndProfiling=t=>(o._OrtEndProfiling=_.za)(t);var yt=()=>(yt=_.Aa)();o._free=t=>(o._free=_.Ba)(t),o._malloc=t=>(o._malloc=_.Ca)(t);var gt=(t,n,l,p,h,g)=>(gt=_.Fa)(t,n,l,p,h,g),qr=()=>(qr=_.Ga)(),Xr=(t,n,l,p,h)=>(Xr=_.Ha)(t,n,l,p,h),Jr=t=>(Jr=_.Ia)(t),bt=t=>(bt=_.Ja)(t),Kr=(t,n)=>(Kr=_.Ka)(t,n),en=()=>(en=_.La)(),tn=(t,n)=>(tn=_.Ma)(t,n),qe=t=>(qe=_.Na)(t),vt=t=>(vt=_.Oa)(t),Et=()=>(Et=_.Pa)();return(function t(){if(0<N)P=t;else if(f)s(o),ie();else{for(;0<ut.length;)ut.shift()(o);0<N?P=t:(o.calledRun=!0,J||(ie(),s(o)))}})(),o.PTR_SIZE=4,u},Hn=Ut,on=(r=(e=globalThis.self)==null?void 0:e.name)==null?void 0:r.startsWith("em-pthread"),on&&Ut()}),xt,Wt,sn,K,zn,Je,un,ln,St,fn,Mt,Qn,Lt,Yn,Qt=U(()=>{zt(),xt=typeof location>"u"?void 0:location.origin,Wt=import.meta.url>"file:"&&import.meta.url<"file;",sn=()=>{{if(Wt){let e=URL;return new URL(new e("ort.wasm.bundle.min.mjs",import.meta.url).href,xt).href}return import.meta.url}},K=sn(),zn=()=>{if(K&&!K.startsWith("blob:"))return K.substring(0,K.lastIndexOf("/")+1)},Je=(e,r)=>{try{let a=r??K;return(a?new URL(e,a):new URL(e)).origin===xt}catch{return!1}},un=(e,r)=>{let a=r??K;try{return(a?new URL(e,a):new URL(e)).href}catch{return}},ln=(e,r)=>`${r??"./"}${e}`,St=async e=>{let r=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(r)},fn=async e=>(await import(e)).default,Mt=(co(),Dt(Gn)).default,Qn=async()=>{if(!K)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Je(K))return[void 0,Mt()];let e=await St(K);return[e,Mt(e)]},Lt=(po(),Dt(jn)).default,Yn=async(e,r,a,s)=>{let i=Lt&&!(e||r);if(i)if(K)i=Je(K);else if(s&&!a)i=!0;else throw new Error("cannot determine the script source URL.");if(i)return[void 0,Lt];{let o="ort-wasm-simd-threaded.mjs",u=e??un(o,r),c=a&&u&&!Je(u,r),d=c?await St(u):u??ln(o,r);return[c?d:void 0,await fn(d)]}}}),Pt,Ke,Fe,It,cn,dn,pn,Yt,$,Me=U(()=>{Qt(),Ke=!1,Fe=!1,It=!1,cn=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},dn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},pn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Yt=async e=>{if(Ke)return Promise.resolve();if(Fe)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(It)throw new Error("previous call to 'initializeWebAssembly()' failed.");Fe=!0;let r=e.initTimeout,a=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!pn())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!dn())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let s=cn();a>1&&!s&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+a+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=a=1);let i=e.wasmPaths,o=typeof i=="string"?i:void 0,u=i==null?void 0:i.mjs,c=(u==null?void 0:u.href)??u,d=i==null?void 0:i.wasm,f=(d==null?void 0:d.href)??d,m=e.wasmBinary,[w,y]=await Yn(c,o,a>1,!!m||!!f),b=!1,E=[];if(r>0&&E.push(new Promise(x=>{setTimeout(()=>{b=!0,x()},r)})),E.push(new Promise((x,M)=>{let v={numThreads:a};if(m)v.wasmBinary=m;else if(f||o)v.locateFile=O=>f??o+O;else if(c&&c.indexOf("blob:")!==0)v.locateFile=O=>new URL(O,c).href;else if(w){let O=zn();O&&(v.locateFile=S=>O+S)}y(v).then(O=>{Fe=!1,Ke=!0,Pt=O,x(),w&&URL.revokeObjectURL(w)},O=>{Fe=!1,It=!0,M(O)})})),await Promise.race(E),b)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},$=()=>{if(Ke&&Pt)return Pt;throw new Error("WebAssembly is not initialized yet.")}}),se,at,k,Zt=U(()=>{Me(),se=(e,r)=>{let a=$(),s=a.lengthBytesUTF8(e)+1,i=a._malloc(s);return a.stringToUTF8(e,i,s),r.push(i),i},at=(e,r,a,s)=>{if(typeof e=="object"&&e!==null){if(a.has(e))throw new Error("Circular reference in options");a.add(e)}Object.entries(e).forEach(([i,o])=>{let u=r?r+i:i;if(typeof o=="object")at(o,u+".",a,s);else if(typeof o=="string"||typeof o=="number")s(u,o.toString());else if(typeof o=="boolean")s(u,o?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof o}`)})},k=e=>{let r=$(),a=r.stackSave();try{let s=r.PTR_SIZE,i=r.stackAlloc(2*s);r._OrtGetLastError(i,i+s);let o=Number(r.getValue(i,s===4?"i32":"i64")),u=r.getValue(i+s,"*"),c=u?r.UTF8ToString(u):"";throw new Error(`${e} ERROR_CODE: ${o}, ERROR_MESSAGE: ${c}`)}finally{r.stackRestore(a)}}}),Zn,ho=U(()=>{Me(),Zt(),Zn=e=>{let r=$(),a=0,s=[],i=e||{};try{if((e==null?void 0:e.logSeverityLevel)===void 0)i.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${e.logSeverityLevel}`);if((e==null?void 0:e.logVerbosityLevel)===void 0)i.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);(e==null?void 0:e.terminate)===void 0&&(i.terminate=!1);let o=0;return(e==null?void 0:e.tag)!==void 0&&(o=se(e.tag,s)),a=r._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,o),a===0&&k("Can't create run options."),(e==null?void 0:e.extra)!==void 0&&at(e.extra,"",new WeakSet,(u,c)=>{let d=se(u,s),f=se(c,s);r._OrtAddRunConfigEntry(a,d,f)!==0&&k(`Can't set a run config entry: ${u} - ${c}.`)}),[a,s]}catch(o){throw a!==0&&r._OrtReleaseRunOptions(a),s.forEach(u=>r._free(u)),o}}}),hn,mn,wn,We,yn,qn,mo=U(()=>{Me(),Zt(),hn=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},mn=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},wn=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let r=e.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(a=>(typeof a=="string"?a:a.name)==="webgpu")&&(e.enableMemPattern=!1)},We=(e,r,a,s)=>{let i=se(r,s),o=se(a,s);$()._OrtAddSessionConfigEntry(e,i,o)!==0&&k(`Can't set a session config entry: ${r} - ${a}.`)},yn=async(e,r,a)=>{for(let s of r){let i=typeof s=="string"?s:s.name,o=[];switch(i){case"webnn":if(i="WEBNN",typeof s!="string"){let m=s==null?void 0:s.deviceType;m&&We(e,"deviceType",m,a)}break;case"webgpu":if(i="JS",typeof s!="string"){let m=s;if(m!=null&&m.preferredLayout){if(m.preferredLayout!=="NCHW"&&m.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${m.preferredLayout}`);We(e,"preferredLayout",m.preferredLayout,a)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let u=se(i,a),c=o.length,d=0,f=0;if(c>0){d=$()._malloc(c*$().PTR_SIZE),a.push(d),f=$()._malloc(c*$().PTR_SIZE),a.push(f);for(let m=0;m<c;m++)$().setValue(d+m*$().PTR_SIZE,o[m][0],"*"),$().setValue(f+m*$().PTR_SIZE,o[m][1],"*")}await $()._OrtAppendExecutionProvider(e,u,d,f,c)!==0&&k(`Can't append execution provider: ${i}.`)}},qn=async e=>{let r=$(),a=0,s=[],i=e||{};wn(i);try{let o=hn(i.graphOptimizationLevel??"all"),u=mn(i.executionMode??"sequential"),c=typeof i.logId=="string"?se(i.logId,s):0,d=i.logSeverityLevel??2;if(!Number.isInteger(d)||d<0||d>4)throw new Error(`log severity level is not valid: ${d}`);let f=i.logVerbosityLevel??0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let m=typeof i.optimizedModelFilePath=="string"?se(i.optimizedModelFilePath,s):0;if(a=r._OrtCreateSessionOptions(o,!!i.enableCpuMemArena,!!i.enableMemPattern,u,!!i.enableProfiling,0,c,d,f,m),a===0&&k("Can't create session options."),i.executionProviders&&await yn(a,i.executionProviders,s),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);We(a,"enableGraphCapture",i.enableGraphCapture.toString(),s)}if(i.freeDimensionOverrides)for(let[w,y]of Object.entries(i.freeDimensionOverrides)){if(typeof w!="string")throw new Error(`free dimension override name must be a string: ${w}`);if(typeof y!="number"||!Number.isInteger(y)||y<0)throw new Error(`free dimension override value must be a non-negative integer: ${y}`);let b=se(w,s);r._OrtAddFreeDimensionOverride(a,b,y)!==0&&k(`Can't set a free dimension override: ${w} - ${y}.`)}return i.extra!==void 0&&at(i.extra,"",new WeakSet,(w,y)=>{We(a,w,y,s)}),[a,s]}catch(o){throw a!==0&&r._OrtReleaseSessionOptions(a)!==0&&k("Can't release session options."),s.forEach(u=>r._free(u)),o}}}),Ce,rt,_e,Xn,Jn,qt,Xt,Kn,ea=U(()=>{Ce=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},rt=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},_e=(e,r)=>{let a=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],s=typeof r=="number"?r:r.reduce((i,o)=>i*o,1);return a>0?Math.ceil(s*a):void 0},Xn=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},Jn=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},qt=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Xt=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",Kn=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),Jt,ta=U(()=>{zt(),Jt=async e=>{if(typeof e=="string"){let r=await fetch(e);if(!r.ok)throw new Error(`failed to load external data file: ${e}`);let a=r.headers.get("Content-Length"),s=a?parseInt(a,10):0;if(s<1073741824)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let i=r.body.getReader(),o;try{o=new ArrayBuffer(s)}catch(c){if(c instanceof RangeError){let d=Math.ceil(s/65536);o=new WebAssembly.Memory({initial:d,maximum:d}).buffer}else throw c}let u=0;for(;;){let{done:c,value:d}=await i.read();if(c)break;let f=d.byteLength;new Uint8Array(o,u,f).set(d),u+=f}return new Uint8Array(o,0,s)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),gn,Kt,er,ye,bn,kt,ot,tr,rr,Bt,nr,ar,or,ra=U(()=>{Ee(),ho(),mo(),ea(),Me(),Zt(),ta(),gn=(e,r)=>{$()._OrtInit(e,r)!==0&&k("Can't initialize onnxruntime.")},Kt=async e=>{gn(e.wasm.numThreads,Jn(e.logLevel))},er=async(e,r)=>{var s,i;(i=(s=$()).asyncInit)==null||i.call(s);let a=e.webgpu.adapter;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(a){if(typeof a.limits!="object"||typeof a.features!="object"||typeof a.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let o=e.webgpu.powerPreference;if(o!==void 0&&o!=="low-power"&&o!=="high-performance")throw new Error(`Invalid powerPreference setting: "${o}"`);let u=e.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(a=await navigator.gpu.requestAdapter({powerPreference:o,forceFallbackAdapter:u}),!a)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(r==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment")},ye=new Map,bn=e=>{let r=$(),a=r.stackSave();try{let s=r.PTR_SIZE,i=r.stackAlloc(2*s);r._OrtGetInputOutputCount(e,i,i+s)!==0&&k("Can't get session input/output count.");let o=s===4?"i32":"i64";return[Number(r.getValue(i,o)),Number(r.getValue(i+s,o))]}finally{r.stackRestore(a)}},kt=(e,r)=>{let a=$(),s=a.stackSave(),i=0;try{let o=a.PTR_SIZE,u=a.stackAlloc(2*o);a._OrtGetInputOutputMetadata(e,r,u,u+o)!==0&&k("Can't get session input/output metadata.");let c=Number(a.getValue(u,"*"));i=Number(a.getValue(u+o,"*"));let d=a.HEAP32[i/4];if(d===0)return[c,0];let f=a.HEAPU32[i/4+1],m=[];for(let w=0;w<f;w++){let y=Number(a.getValue(i+8+w*o,"*"));m.push(y!==0?a.UTF8ToString(y):Number(a.getValue(i+8+(w+f)*o,"*")))}return[c,d,m]}finally{a.stackRestore(s),i!==0&&a._OrtFree(i)}},ot=e=>{let r=$(),a=r._malloc(e.byteLength);if(a===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return r.HEAPU8.set(e,a),[a,e.byteLength]},tr=async(e,r)=>{var m,w,y;let a,s,i=$();Array.isArray(e)?[a,s]=e:e.buffer===i.HEAPU8.buffer?[a,s]=[e.byteOffset,e.byteLength]:[a,s]=ot(e);let o=0,u=0,c=[],d=[],f=[];try{if([u,c]=await qn(r),(r==null?void 0:r.externalData)&&i.mountExternalData){let L=[];for(let R of r.externalData){let V=typeof R=="string"?R:R.path;L.push(Jt(typeof R=="string"?R:R.data).then(H=>{i.mountExternalData(V,H)}))}await Promise.all(L)}for(let L of(r==null?void 0:r.executionProviders)??[])if((typeof L=="string"?L:L.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof L!="string"){let R=L,V=R==null?void 0:R.context,H=R==null?void 0:R.gpuDevice,Z=R==null?void 0:R.deviceType,q=R==null?void 0:R.powerPreference;V?i.currentContext=V:H?i.currentContext=await i.webnnCreateMLContext(H):i.currentContext=await i.webnnCreateMLContext({deviceType:Z,powerPreference:q})}else i.currentContext=await i.webnnCreateMLContext();break}o=await i._OrtCreateSession(a,s,u),(m=i.webgpuOnCreateSession)==null||m.call(i,o),o===0&&k("Can't create a session."),(w=i.jsepOnCreateSession)==null||w.call(i),i.currentContext&&(i.webnnRegisterMLContext(o,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[b,E]=bn(o),x=!!(r!=null&&r.enableGraphCapture),M=[],v=[],O=[],S=[],I=[];for(let L=0;L<b;L++){let[R,V,H]=kt(o,L);R===0&&k("Can't get an input name."),d.push(R);let Z=i.UTF8ToString(R);M.push(Z),O.push(V===0?{name:Z,isTensor:!1}:{name:Z,isTensor:!0,type:rt(V),shape:H})}for(let L=0;L<E;L++){let[R,V,H]=kt(o,L+b);R===0&&k("Can't get an output name."),f.push(R);let Z=i.UTF8ToString(R);v.push(Z),S.push(V===0?{name:Z,isTensor:!1}:{name:Z,isTensor:!0,type:rt(V),shape:H})}return ye.set(o,[o,d,f,null,x,!1]),[o,M,v,O,S]}catch(b){throw d.forEach(E=>i._OrtFree(E)),f.forEach(E=>i._OrtFree(E)),o!==0&&i._OrtReleaseSession(o)!==0&&k("Can't release session."),b}finally{i._free(a),u!==0&&i._OrtReleaseSessionOptions(u)!==0&&k("Can't release session options."),c.forEach(b=>i._free(b)),(y=i.unmountExternalData)==null||y.call(i)}},rr=e=>{var d,f,m;let r=$(),a=ye.get(e);if(!a)throw new Error(`cannot release session. invalid session id: ${e}`);let[s,i,o,u,c]=a;u&&(c&&r._OrtClearBoundOutputs(u.handle)!==0&&k("Can't clear bound outputs."),r._OrtReleaseBinding(u.handle)!==0&&k("Can't release IO binding.")),(d=r.jsepOnReleaseSession)==null||d.call(r,e),(f=r.webnnOnReleaseSession)==null||f.call(r,e),(m=r.webgpuOnReleaseSession)==null||m.call(r,e),i.forEach(w=>r._OrtFree(w)),o.forEach(w=>r._OrtFree(w)),r._OrtReleaseSession(s)!==0&&k("Can't release session."),ye.delete(e)},Bt=async(e,r,a,s,i,o,u=!1)=>{if(!e){r.push(0);return}let c=$(),d=c.PTR_SIZE,f=e[0],m=e[1],w=e[3],y=w,b,E;if(f==="string"&&(w==="gpu-buffer"||w==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(u&&w!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(w==="gpu-buffer"){let v=e[2].gpuBuffer;E=_e(Ce(f),m);{let O=c.jsepRegisterBuffer;if(!O)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');b=O(s,o,v,E)}}else if(w==="ml-tensor"){let v=e[2].mlTensor;E=_e(Ce(f),m);let O=c.webnnRegisterMLTensor;if(!O)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');b=O(s,v,Ce(f),m)}else{let v=e[2];if(Array.isArray(v)){E=d*v.length,b=c._malloc(E),a.push(b);for(let O=0;O<v.length;O++){if(typeof v[O]!="string")throw new TypeError(`tensor data at index ${O} is not a string`);c.setValue(b+O*d,se(v[O],a),"*")}}else{let O=c.webnnIsGraphInput,S=c.webnnIsGraphOutput;if(f!=="string"&&O&&S){let I=c.UTF8ToString(i);if(O(s,I)||S(s,I)){let L=Ce(f);E=_e(L,m),y="ml-tensor";let R=c.webnnCreateTemporaryTensor,V=c.webnnUploadTensor;if(!R||!V)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let H=await R(s,L,m);V(H,new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),b=H}else E=v.byteLength,b=c._malloc(E),a.push(b),c.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,E),b)}else E=v.byteLength,b=c._malloc(E),a.push(b),c.HEAPU8.set(new Uint8Array(v.buffer,v.byteOffset,E),b)}}let x=c.stackSave(),M=c.stackAlloc(4*m.length);try{m.forEach((O,S)=>c.setValue(M+S*d,O,d===4?"i32":"i64"));let v=c._OrtCreateTensor(Ce(f),b,E,M,m.length,Kn(y));v===0&&k(`Can't create tensor for input/output. session=${s}, index=${o}.`),r.push(v)}finally{c.stackRestore(x)}},nr=async(e,r,a,s,i,o)=>{var q,Le,Pe;let u=$(),c=u.PTR_SIZE,d=ye.get(e);if(!d)throw new Error(`cannot run inference. invalid session id: ${e}`);let f=d[0],m=d[1],w=d[2],y=d[3],b=d[4];d[5];let E=r.length,x=s.length,M=0,v=[],O=[],S=[],I=[],L=u.stackSave(),R=u.stackAlloc(E*c),V=u.stackAlloc(E*c),H=u.stackAlloc(x*c),Z=u.stackAlloc(x*c);try{[M,v]=Zn(o),xe("wasm prepareInputOutputTensor");for(let A=0;A<E;A++)await Bt(a[A],O,I,e,m[r[A]],r[A],b);for(let A=0;A<x;A++)await Bt(i[A],S,I,e,w[s[A]],E+s[A],b);Se("wasm prepareInputOutputTensor");for(let A=0;A<E;A++)u.setValue(R+A*c,O[A],"*"),u.setValue(V+A*c,m[r[A]],"*");for(let A=0;A<x;A++)u.setValue(H+A*c,S[A],"*"),u.setValue(Z+A*c,w[s[A]],"*");(q=u.jsepOnRunStart)==null||q.call(u,f),(Le=u.webnnOnRunStart)==null||Le.call(u,f);let te;te=await u._OrtRun(f,V,R,E,Z,x,H,M),te!==0&&k("failed to call OrtRun().");let ne=[],Ie=[];xe("wasm ProcessOutputTensor");for(let A=0;A<x;A++){let J=Number(u.getValue(H+A*c,"*"));if(J===S[A]){ne.push(i[A]);continue}let He=u.stackSave(),ae=u.stackAlloc(4*c),oe=!1,W,T=0;try{u._OrtGetTensorData(J,ae,ae+c,ae+2*c,ae+3*c)!==0&&k(`Can't access output tensor data on index ${A}.`);let j=c===4?"i32":"i64",me=Number(u.getValue(ae,j));T=u.getValue(ae+c,"*");let fe=u.getValue(ae+c*2,"*"),ze=Number(u.getValue(ae+c*3,j)),G=[];for(let N=0;N<ze;N++)G.push(Number(u.getValue(fe+N*c,j)));u._OrtFree(fe)!==0&&k("Can't free memory for tensor dims.");let ie=G.reduce((N,P)=>N*P,1);W=rt(me);let le=y==null?void 0:y.outputPreferredLocations[s[A]];if(W==="string"){if(le==="gpu-buffer"||le==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let N=[];for(let P=0;P<ie;P++){let re=u.getValue(T+P*c,"*"),ce=u.getValue(T+(P+1)*c,"*"),Qe=P===ie-1?void 0:ce-re;N.push(u.UTF8ToString(re,Qe))}ne.push([W,G,N,"cpu"])}else if(le==="gpu-buffer"&&ie>0){let N=u.jsepGetBuffer;if(!N)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let P=N(T),re=_e(me,ie);if(re===void 0||!qt(W))throw new Error(`Unsupported data type: ${W}`);oe=!0,ne.push([W,G,{gpuBuffer:P,download:u.jsepCreateDownloader(P,re,W),dispose:()=>{u._OrtReleaseTensor(J)!==0&&k("Can't release tensor.")}},"gpu-buffer"])}else if(le==="ml-tensor"&&ie>0){let N=u.webnnEnsureTensor,P=u.webnnIsGraphInputOutputTypeSupported;if(!N||!P)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(_e(me,ie)===void 0||!Xt(W))throw new Error(`Unsupported data type: ${W}`);if(!P(e,W,!1))throw new Error(`preferredLocation "ml-tensor" for ${W} output is not supported by current WebNN Context.`);let re=await N(e,T,me,G,!1);oe=!0,ne.push([W,G,{mlTensor:re,download:u.webnnCreateMLTensorDownloader(T,W),dispose:()=>{u.webnnReleaseTensorId(T),u._OrtReleaseTensor(J)}},"ml-tensor"])}else if(le==="ml-tensor-cpu-output"&&ie>0){let N=u.webnnCreateMLTensorDownloader(T,W)(),P=ne.length;oe=!0,Ie.push((async()=>{let re=[P,await N];return u.webnnReleaseTensorId(T),u._OrtReleaseTensor(J),re})()),ne.push([W,G,[],"cpu"])}else{let N=Xn(W),P=new N(ie);new Uint8Array(P.buffer,P.byteOffset,P.byteLength).set(u.HEAPU8.subarray(T,T+P.byteLength)),ne.push([W,G,P,"cpu"])}}finally{u.stackRestore(He),W==="string"&&T&&u._free(T),oe||u._OrtReleaseTensor(J)}}y&&!b&&(u._OrtClearBoundOutputs(y.handle)!==0&&k("Can't clear bound outputs."),ye.set(e,[f,m,w,y,b,!1]));for(let[A,J]of await Promise.all(Ie))ne[A][2]=J;return Se("wasm ProcessOutputTensor"),ne}finally{(Pe=u.webnnOnRunEnd)==null||Pe.call(u,f),u.stackRestore(L),O.forEach(te=>u._OrtReleaseTensor(te)),S.forEach(te=>u._OrtReleaseTensor(te)),I.forEach(te=>u._free(te)),M!==0&&u._OrtReleaseRunOptions(M),v.forEach(te=>u._free(te))}},ar=e=>{let r=$(),a=ye.get(e);if(!a)throw new Error("invalid session id");let s=a[0],i=r._OrtEndProfiling(s);i===0&&k("Can't get an profile file name."),r._OrtFree(i)},or=e=>{let r=[];for(let a of e){let s=a[2];!Array.isArray(s)&&"buffer"in s&&r.push(s.buffer)}return r}}),he,X,Ae,Ge,Ve,et,$t,tt,ge,be,vn,na,aa,oa,ia,sa,ua,la,fa=U(()=>{Ee(),ra(),Me(),Qt(),he=()=>!!F.wasm.proxy&&typeof document<"u",Ae=!1,Ge=!1,Ve=!1,tt=new Map,ge=(e,r)=>{let a=tt.get(e);a?a.push(r):tt.set(e,[r])},be=()=>{if(Ae||!Ge||Ve||!X)throw new Error("worker not ready")},vn=e=>{switch(e.data.type){case"init-wasm":Ae=!1,e.data.err?(Ve=!0,$t[1](e.data.err)):(Ge=!0,$t[0]()),et&&(URL.revokeObjectURL(et),et=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=tt.get(e.data.type);e.data.err?r.shift()[1](e.data.err):r.shift()[0](e.data.out);break}}},na=async()=>{if(!Ge){if(Ae)throw new Error("multiple calls to 'initWasm()' detected.");if(Ve)throw new Error("previous call to 'initWasm()' failed.");if(Ae=!0,he())return new Promise((e,r)=>{X==null||X.terminate(),Qn().then(([a,s])=>{try{X=s,X.onerror=o=>r(o),X.onmessage=vn,$t=[e,r];let i={type:"init-wasm",in:F};!i.in.wasm.wasmPaths&&(a||Wt)&&(i.in.wasm.wasmPaths={wasm:new URL("/komasync/assets/ort-wasm-simd-threaded-CxTQ5xH-.wasm",import.meta.url).href}),X.postMessage(i),et=a}catch(i){r(i)}},r)});try{await Yt(F.wasm),await Kt(F),Ge=!0}catch(e){throw Ve=!0,e}finally{Ae=!1}}},aa=async e=>{if(he())return be(),new Promise((r,a)=>{ge("init-ep",[r,a]);let s={type:"init-ep",in:{epName:e,env:F}};X.postMessage(s)});await er(F,e)},oa=async e=>he()?(be(),new Promise((r,a)=>{ge("copy-from",[r,a]);let s={type:"copy-from",in:{buffer:e}};X.postMessage(s,[e.buffer])})):ot(e),ia=async(e,r)=>{if(he()){if(r!=null&&r.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return be(),new Promise((a,s)=>{ge("create",[a,s]);let i={type:"create",in:{model:e,options:{...r}}},o=[];e instanceof Uint8Array&&o.push(e.buffer),X.postMessage(i,o)})}else return tr(e,r)},sa=async e=>{if(he())return be(),new Promise((r,a)=>{ge("release",[r,a]);let s={type:"release",in:e};X.postMessage(s)});rr(e)},ua=async(e,r,a,s,i,o)=>{if(he()){if(a.some(u=>u[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(u=>u))throw new Error("pre-allocated output tensor is not supported for proxy.");return be(),new Promise((u,c)=>{ge("run",[u,c]);let d=a,f={type:"run",in:{sessionId:e,inputIndices:r,inputs:d,outputIndices:s,options:o}};X.postMessage(f,or(d))})}else return nr(e,r,a,s,i,o)},la=async e=>{if(he())return be(),new Promise((r,a)=>{ge("end-profiling",[r,a]);let s={type:"end-profiling",in:e};X.postMessage(s)});ar(e)}}),Nt,En,ca,wo=U(()=>{Ee(),fa(),ea(),zt(),ta(),Nt=(e,r)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${r()}`)}},En=e=>{switch(e[3]){case"cpu":return new ue(e[0],e[2],e[1]);case"gpu-buffer":{let r=e[0];if(!qt(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:a,download:s,dispose:i}=e[2];return ue.fromGpuBuffer(a,{dataType:r,dims:e[1],download:s,dispose:i})}case"ml-tensor":{let r=e[0];if(!Xt(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:a,download:s,dispose:i}=e[2];return ue.fromMLTensor(a,{dataType:r,dims:e[1],download:s,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},ca=class{async fetchModelAndCopyToWasmMemory(e){return oa(await Jt(e))}async loadModel(e,r){Re();let a;typeof e=="string"?a=await this.fetchModelAndCopyToWasmMemory(e):a=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await ia(a,r),Ue()}async dispose(){return sa(this.sessionId)}async run(e,r,a){Re();let s=[],i=[];Object.entries(e).forEach(w=>{let y=w[0],b=w[1],E=this.inputNames.indexOf(y);if(E===-1)throw new Error(`invalid input '${y}'`);s.push(b),i.push(E)});let o=[],u=[];Object.entries(r).forEach(w=>{let y=w[0],b=w[1],E=this.outputNames.indexOf(y);if(E===-1)throw new Error(`invalid output '${y}'`);o.push(b),u.push(E)});let c=s.map((w,y)=>Nt(w,()=>`input "${this.inputNames[i[y]]}"`)),d=o.map((w,y)=>w?Nt(w,()=>`output "${this.outputNames[u[y]]}"`):null),f=await ua(this.sessionId,i,c,u,d,a),m={};for(let w=0;w<f.length;w++)m[this.outputNames[u[w]]]=o[w]??En(f[w]);return Ue(),m}startProfiling(){}endProfiling(){la(this.sessionId)}}}),da={};it(da,{OnnxruntimeWebAssemblyBackend:()=>Vt,initializeFlags:()=>Gt,wasmBackend:()=>pa});var Gt,Vt,pa,yo=U(()=>{Ee(),fa(),wo(),Gt=()=>{(typeof F.wasm.initTimeout!="number"||F.wasm.initTimeout<0)&&(F.wasm.initTimeout=0);let e=F.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),F.wasm.simd=!1),typeof F.wasm.proxy!="boolean"&&(F.wasm.proxy=!1),typeof F.wasm.trace!="boolean"&&(F.wasm.trace=!1),typeof F.wasm.numThreads!="number"||!Number.isInteger(F.wasm.numThreads)||F.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)F.wasm.numThreads=1;else{let r=typeof navigator>"u"?qa("node:os").cpus().length:navigator.hardwareConcurrency;F.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},Vt=class{async init(e){Gt(),await na(),await aa(e)}async createInferenceSessionHandler(e,r){let a=new ca;return await a.loadModel(e,r),a}},pa=new Vt});Ee();Ee();Ee();var go="1.23.2",vo=Wn;{let e=(yo(),Dt(da)).wasmBackend;nt("cpu",e,10),nt("wasm",e,10)}Object.defineProperty(F.versions,"web",{value:go,enumerable:!0});export{Fn as InferenceSession,Ft as TRACE,xe as TRACE_EVENT_BEGIN,Se as TRACE_EVENT_END,Re as TRACE_FUNC_BEGIN,Ue as TRACE_FUNC_END,ue as Tensor,vo as default,F as env,nt as registerBackend};
